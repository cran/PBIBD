apbibd4 <-
function(v,r,k,l,n,P){
A1<-r*(k-1)+l[4]
A2<-l[4]-l[1]
A3<-l[4]-l[2]
A4<-l[4]-l[3]
B1<-(l[2]-l[1])*P[[4]][1,2]+(l[3]-l[1])*P[[4]][1,3]+(l[4]-l[1])*P[[4]][1,4]
B2<-A1+A2*(P[[1]][1,1]-P[[4]][1,1])+A3*(P[[1]][1,2]-P[[4]][1,2])+A4*(P[[1]][1,3]-P[[4]][1,3])
B3<-A2*(P[[2]][1,1]-P[[4]][1,1])+A3*(P[[2]][1,2]-P[[4]][1,2])+A4*(P[[2]][1,3]-P[[4]][1,3])
B4<-A2*(P[[3]][1,1]-P[[4]][1,1])+A3*(P[[3]][1,2]-P[[4]][1,2])+A4*(P[[3]][1,3]-P[[4]][1,3])
C1<-(l[1]-l[2])*P[[4]][2,1]+(l[3]-l[2])*P[[4]][2,3]+A3*P[[4]][2,4]
C2<-A2*(P[[1]][2,1]-P[[4]][2,1])+A3*(P[[1]][2,2]-P[[4]][2,2])+A4*(P[[1]][2,3]-P[[4]][2,3])
C3<-A1+A2*(P[[2]][2,1]-P[[4]][2,1])+A3*(P[[2]][2,2]-P[[4]][2,2])+A4*(P[[2]][2,3]-P[[4]][2,3])
C4<-A2*(P[[3]][2,1]-P[[4]][2,1])+A3*(P[[3]][2,2]-P[[4]][2,2])+A4*(P[[3]][2,3]-P[[4]][2,3])
D1<-(l[1]-l[3])*P[[4]][3,1]+(l[2]-l[3])*P[[4]][3,2]+A4*P[[4]][3,4]
D2<-A2*(P[[1]][3,1]-P[[4]][3,1])+A3*(P[[1]][3,2]-P[[4]][3,2])+A4*(P[[1]][3,3]-P[[4]][3,3])
D3<-A2*(P[[2]][3,1]-P[[4]][3,1])+A3*(P[[2]][3,2]-P[[4]][3,2])+A4*(P[[2]][3,3]-P[[4]][3,3])
D4<-A1+A2*(P[[3]][3,1]-P[[4]][3,1])+A3*(P[[3]][3,2]-P[[4]][3,2])+A4*(P[[3]][3,3]-P[[4]][3,3])
F<-matrix(c(B2,C2,D2,B3,C3,D3,B4,C4,D4),3,3)
G<-matrix(c(A2,C2,D2,A3,C3,D3,A4,C4,D4),3,3)
H<-matrix(c(A2,B2,D2,A3,B3,D3,A4,B4,D4),3,3)
I<-matrix(c(A2,B2,C2,A3,B3,C3,A4,B4,C4),3,3)
del<-A1*det(F)-B1*det(G)+C1*det(H)-D1*det(I)
E1<-del/(r*k*(det(F)+det(G)))
E2<-del/(r*k*(det(F)-det(H)))
E3<-del/(r*k*(det(F)+det(I)))
E4<-del/(r*k*(det(F)))
E<-del*(v-1)/(r*k*((v-1)*det(F)+n[1]*det(G)-n[2]*det(H)+n[3]*det(I)))
lst<-list(Efficiency_E1=E1,Efficiency_E2=E2,Efficienct_E3=E3,Efficiency_E4=E4,Overall_Efficiency_Factor=E)
return(lst)
}
